;===================================================================
; ASM Test : Bitfields
; S C:\Users\FORMATION\Desktop\output12.txt 4026d982 3C
;===================================================================

assert_zero EQU $00D0000C       ; magical register

size = 60

;===================================================================
; Main
;===================================================================

Start:

    clr.l  d0
    clr.l  d1
    
    lea    values,a0
    lea    calcs,a1
    lea    precalcs,a2
    
    move.w #((size/6)-1),d7

.MainLoop
    
    ; Test #1 : Dn{0:16}

    move.l (a0)+,d0         ; read value
    bfffo  d0{0:16},d1      ; bfffo
    move.b d1,(a1)+         ; store value
    sub.b  (a2)+,d1         ; test value
    move.l d1,assert_zero   ; raise error if d1 != 0
    
    ; Test #2 : Dn{2:31}
    
    move.l (a0)+,d0         ; 
    bfffo  d0{2:31},d1      ; 
    move.b d1,(a1)+         ; 
    sub.b  (a2)+,d1         ; 
    move.l d1,assert_zero   ; 

    ; Test #3 : Dn{9:22}
    
    move.l (a0)+,d0         ; 
    bfffo  d0{9:22},d1      ; 
    move.b d1,(a1)+         ; 
    sub.b  (a2)+,d1         ; 
    move.l d1,assert_zero   ; 

    ; Test #4 : Dn{16:16}
    
    move.l (a0)+,d0         ; 
    bfffo  d0{16:16},d1     ; 
    move.b d1,(a1)+         ; 
    sub.b  (a2)+,d1         ; 
    move.l d1,assert_zero   ; 

    ; Test #5 : Dn{30:32}
    
    move.l (a0)+,d0         ; 
    bfffo  d0{30:32},d1     ; 
    move.b d1,(a1)+         ; 
    sub.b  (a2)+,d1         ; 
    move.l d1,assert_zero   ; 

    ; Test #6 : Dn{30:32}
    
    move.l (a0)+,d0         ; 
    bfffo  d0{31:32},d1     ; 
    move.b d1,(a1)+         ; 
    sub.b  (a2)+,d1         ; 
    move.l d1,assert_zero   ; 

    ; Continue ?

    dbf    d7,.MainLoop
    stop   #-1

;===================================================================
; Data Section
;===================================================================

values:

    dc.l %00000000000000000000000000000001,%00000000010000000000000000000001
    dc.l %00000000000000000000000110000000,%01111000101000110000000001010001
    dc.l %00000000100001001110100001010000,%01000000000000000000000000000000

    dc.l %01101011101010110111110110010111,%10111110110101110110111100111011
    dc.l %00110001001000000001110101111110,%00110110010100110000010000000010
    dc.l %00001001100110000000111000110100,%11110001011100101000000010101000

    dc.l %01010000101001101011001001000101,%11011010100110011100111111011110
    dc.l %11011111110011011011011001000111,%00101111101000101000000110011110
    dc.l %00000100111110001000011101011101,%00110101110110001001101011000011

    dc.l %00001110100010110011100011110111,%01001101111101100010101011000100
    dc.l %01111001001000010001000010011111,%01001000101000110110010001010000
    dc.l %01111111111100111000101111101100,%10100111001001101010111011001111

    dc.l %00100010101100010100101000101110,%10001010101111110011001111111111
    dc.l %11010011110100101000111110001110,%10110111010111110010101011111010
    dc.l %01101001001010110001110011000010,%00000111010100011110111110100100

    dc.l %00101001010000000011100001100110,%10100100000001111001100100011011
    dc.l %00011111100101110000110100000100,%11111110010001111100110111101101
    dc.l %00000100101000000101000110101000,%10111101000010110101110110001110

    dc.l %01100011110011100010111111110101,%10011000110110010001011110010111
    dc.l %10100000011101000110111101011101,%00110001100001101010011000100010
    dc.l %01001001100000001000001111001111,%01011001101111101101000011101111

    dc.l %00010001110001010010010100111000,%10011110011100111010100110011010
    dc.l %01001100110000111100110101100010,%00001011011110101010100110000010
    dc.l %10010010001111101001101000110000,%00101001111011010111110100011101

    dc.l %11010001010111110100010110101101,%11101100100001011100010100011001
    dc.l %11101101110001011011011010010011,%10101001000100000001110001100111
    dc.l %10011010010110010100001100001010,%10101010000000110001000100010010

    dc.l %11000001111010110011001001100001,%10111011100110001101111001100001
    dc.l %11101111110110011110100100000010,%10011100110100111010011101101110
    dc.l %10100111101110010100010101111000,%11001101100100110000000001111110

calcs:
    ds.b size

precalcs:
    dc.b $00,$06,$09,$19,$28,$1E
    dc.b $01,$02,$0A,$15,$24,$20
    dc.b $01,$03,$09,$10,$1F,$1E
    dc.b $04,$04,$0A,$11,$21,$1E
    dc.b $02,$04,$09,$12,$1E,$25
    dc.b $02,$02,$0B,$10,$25,$1E
    dc.b $01,$03,$09,$10,$1E,$1E
    dc.b $03,$03,$09,$10,$20,$1F
    dc.b $00,$02,$09,$13,$1E,$1E
    dc.b $00,$02,$09,$10,$20,$1E

;===================================================================
; End of program
;===================================================================
